# 管理者向け詳細ガイド

このファイルの配置場所: プロジェクトルート/ADMIN_GUIDE.md

クイズアプリの管理者向け機能の詳細な使用方法とベストプラクティスです。

## 📋 目次

1. [管理者アプリ概要](#管理者アプリ概要)
2. [GUI版の使用方法](#gui版の使用方法)
3. [CLI版の使用方法](#cli版の使用方法)
4. [CSVファイル仕様](#csvファイル仕様)
5. [データベース管理](#データベース管理)
6. [バックアップ・復元](#バックアップ復元)
7. [トラブルシューティング](#トラブルシューティング)
8. [Web化への移行準備](#web化への移行準備)

## 🛠️ 管理者アプリ概要

### 基本起動方法

```bash
# GUI版（推奨）
python admin.py

# CLI版
python admin.py [オプション]

# ヘルプ表示
python admin.py --help
```

### 主な機能

| 機能 | GUI版 | CLI版 | 説明 |
|------|-------|-------|------|
| CSVインポート | ✅ | ✅ | 問題データの単体インポート |
| 一括インポート | ✅ | ✅ | フォルダ内の全CSVを一括処理 |
| データベース情報表示 | ✅ | ✅ | 問題数、統計情報の確認 |
| ユーザーアプリ起動 | ✅ | ❌ | GUI版からユーザーアプリを直接起動 |
| リアルタイム進捗表示 | ✅ | ❌ | インポート進捗のリアルタイム表示 |

## 📱 GUI版の使用方法

### 起動と画面構成

```bash
python admin.py
```

#### 画面構成
- **タイトルバー**: 🛠️ クイズアプリ管理者パネル
- **データベース情報エリア**: 問題数、統計情報を表示
- **操作ボタンエリア**: 各種機能ボタン

#### 主要ボタンの説明

| ボタン | 機能 | 使用タイミング |
|--------|------|----------------|
| 📂 CSVファイルをインポート | 単体CSVファイルのインポート | 新しい問題セットを追加する時 |
| 📁 フォルダ一括インポート | フォルダ内の全CSVを処理 | 大量の問題ファイルを一度に処理 |
| 🔄 情報更新 | データベース情報の再読み込み | インポート後の状況確認 |
| 🎯 ユーザーアプリ起動 | quiz.pyを起動 | インポート後の動作確認 |

### GUI版の詳細操作

#### 1. CSVファイルのインポート

1. **📂 CSVファイルをインポート** ボタンをクリック
2. ファイル選択ダイアログで対象CSVを選択
3. インポート進捗がリアルタイムで表示
4. 完了ダイアログで結果を確認
5. **🔄 情報更新** で最新状況を確認

**表示される結果情報**:
- 成功問題数
- スキップ問題数（重複）
- エラー問題数

#### 2. フォルダ一括インポート

1. **📁 フォルダ一括インポート** ボタンをクリック
2. CSVファイルが含まれるフォルダを選択
3. 確認ダイアログで実行を確認
4. 各ファイルの処理状況がリアルタイムで表示
5. 完了ダイアログで全体結果を確認

**一括インポートの利点**:
- 複数ファイルの自動処理
- 進捗状況の可視化
- エラーファイルの特定が容易

#### 3. データベース情報の確認

データベース情報エリアには以下が表示されます：

```
📊 データベース統計情報
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📝 問題データ
   問題数: 150問
   カテゴリ: 数学, 歴史, 科学
   難易度: 初級, 中級, 上級

📈 利用状況
   セッション数: 25件
   履歴数: 25件

💾 データベース情報
   場所: sqlite:///quiz.db
   
🎯 利用状況
   - 問題データが存在します: はい
   - ユーザーアプリ起動可能: はい
```

## 💻 CLI版の使用方法

### 基本コマンド構文

```bash
python admin.py [オプション] [パラメータ]
```

### 利用可能なオプション

#### 単体CSVインポート
```bash
python admin.py --import [CSVファイルパス]

# 例
python admin.py --import ./data/math_quiz.csv
python admin.py --import "C:\quiz_data\science.csv"
```

#### 一括インポート
```bash
python admin.py --batch [ディレクトリパス]

# 例
python admin.py --batch ./data/
python admin.py --batch "C:\quiz_data\"
```

#### 上書きモード
```bash
python admin.py --import [CSVファイル] --overwrite
python admin.py --batch [ディレクトリ] --overwrite
```

#### データベース情報表示
```bash
python admin.py --info
```

### CLI版の実行例

#### 例1: 単体ファイルのインポート
```bash
$ python admin.py --import ./sample_quiz.csv

📂 CSVインポート開始: ./sample_quiz.csv
✅ インポート完了:
   成功: 10問
   スキップ: 0問
   エラー: 0問
```

#### 例2: フォルダ一括インポート
```bash
$ python admin.py --batch ./quiz_data/

📁 一括インポート開始: 3ファイル

--- math.csv ---
✅ 成功: 25問インポート

--- history.csv ---
✅ 成功: 30問インポート

--- science.csv ---
❌ 失敗: 2個のエラー

=== 一括インポート完了 ===
成功ファイル: 2/3
総インポート数: 55問
```

#### 例3: データベース情報確認
```bash
$ python admin.py --info

=== データベース情報 ===
問題数: 150問
セッション数: 25件
履歴数: 25件
カテゴリ: 数学, 歴史, 科学
難易度: 初級, 中級, 上級
データベース: sqlite:///quiz.db
```

## 📊 CSVファイル仕様

### 標準形式（推奨）

```csv
question,option1,option2,option3,option4,correct_answer,explanation,genre,difficulty
日本の首都は？,東京,大阪,名古屋,札幌,1,日本の首都は東京です。,地理,初級
1+1=?,1,2,3,4,2,基本的な足し算です。,数学,初級
```

### 最小形式

```csv
question,option1,option2,option3,option4,correct_answer
日本の首都は？,東京,大阪,名古屋,札幌,1
1+1=?,1,2,3,4,2
```

### 列の詳細仕様

| 列名 | データ型 | 必須 | 説明 | 制限事項 |
|------|----------|------|------|----------|
| `question` | 文字列 | ✅ | 問題文 | 空文字列不可 |
| `option1` | 文字列 | ✅ | 選択肢1 | 空文字列不可 |
| `option2` | 文字列 | ✅ | 選択肢2 | 空文字列不可 |
| `option3` | 文字列 | ✅ | 選択肢3 | 空文字列不可 |
| `option4` | 文字列 | ✅ | 選択肢4 | 空文字列不可 |
| `correct_answer` | 整数 | ✅ | 正解番号 | 1-4の範囲 |
| `explanation` | 文字列 | | 解説 | 空文字列可 |
| `genre` | 文字列 | | ジャンル/カテゴリ | 統計・絞り込み用 |
| `difficulty` | 文字列 | | 難易度 | 初級/中級/上級など |

### CSVファイル作成時の注意点

#### エンコーディング
- **推奨**: UTF-8
- **対応**: Shift_JIS（自動検出）

#### ファイル名規則
- 英数字、アンダースコア、ハイフンを推奨
- 日本語ファイル名も対応
- 拡張子は`.csv`

#### データ品質チェックリスト
- [ ] ヘッダー行が正しく設定されている
- [ ] 必須列がすべて存在する
- [ ] `correct_answer`が1-4の範囲内
- [ ] 選択肢に空文字列がない
- [ ] 文字エンコーディングが適切

### よくあるCSVエラーと対処法

#### エラー1: 「必要な列が不足しています」
```
❌ エラー: 必要な列が不足しています: correct_answer
```
**対処法**: CSVファイルのヘッダー行を確認し、必須列を追加

#### エラー2: 「正解番号が範囲外です」
```
❌ エラー: 行3: 正解番号が範囲外です: 5
```
**対処法**: `correct_answer`列の値を1-4の範囲に修正

#### エラー3: 「選択肢が空です」
```
❌ エラー: 行5: 選択肢2が空です
```
**対処法**: 空の選択肢に適切な文字列を設定

## 💾 データベース管理

### データベースファイル

- **ファイル名**: `quiz.db`
- **形式**: SQLite
- **場所**: アプリケーションと同じディレクトリ

### テーブル構成

```sql
-- 問題データ
questions
├── id (主キー)
├── question (問題文)
├── options (選択肢JSON)
├── correct_answer (正解番号)
├── explanation (解説)
├── genre (ジャンル)
├── difficulty (難易度)
└── csv_source_file (元CSVファイル)

-- セッション管理
quiz_sessions
├── session_id (セッションID)
├── total_questions (総問題数)
├── score (スコア)
└── completed_at (完了日時)

-- 履歴データ
user_history
├── session_id (セッションID)
├── csv_file (使用CSVファイル)
├── total_questions (総問題数)
├── score (スコア)
├── accuracy (正答率)
└── timestamp (実行日時)
```

### データベース操作

#### データベース情報の確認
```bash
python admin.py --info
```

#### データベースの再構築
```bash
# 既存データベースを削除
rm quiz.db

# 新しいデータベースにインポート
python admin.py --batch ./data/
```

## 🔒 バックアップ・復元

### バックアップ作成

#### 手動バックアップ
```bash
# データベースファイルをコピー
cp quiz.db quiz_backup_$(date +%Y%m%d).db
```

#### 定期バックアップスクリプト例
```bash
#!/bin/bash
# backup.sh

BACKUP_DIR="./backups"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="quiz_backup_${DATE}.db"

mkdir -p $BACKUP_DIR
cp quiz.db "$BACKUP_DIR/$BACKUP_FILE"

echo "バックアップ完了: $BACKUP_DIR/$BACKUP_FILE"
```

### 復元手順

```bash
# 1. 現在のデータベースをバックアップ
cp quiz.db quiz_current_backup.db

# 2. バックアップファイルを復元
cp quiz_backup_20250728.db quiz.db

# 3. 動作確認
python admin.py --info
```

## 🚨 トラブルシューティング

### よくある問題と解決方法

#### 問題1: 管理者アプリが起動しない

**症状**:
```
ImportError: No module named 'app.config'
```

**解決方法**:
1. プロジェクトルートディレクトリで実行されているか確認
2. 必要なファイルが存在するか確認
3. Pythonパスが正しく設定されているか確認

#### 問題2: CSVインポートが失敗する

**症状**:
```
❌ CSVインポートエラー: Failed to read CSV
```

**チェック項目**:
- [ ] CSVファイルが存在する
- [ ] ファイルの読み取り権限がある
- [ ] ファイルが他のアプリで開かれていない
- [ ] エンコーディングが対応している（UTF-8またはShift_JIS）

#### 問題3: データベースエラー

**症状**:
```
❌ データベース接続に失敗しました
```

**解決方法**:
1. `quiz.db`ファイルが破損している可能性
2. データベースファイルを削除して再作成
3. 権限を確認（読み書き可能か）

### デバッグモード

詳細なログを表示するには：

1. `config.json`を編集
```json
{
  "debug": true
}
```

2. 管理者アプリを再起動

### ログの確認

エラーの詳細情報は以下で確認できます：
- コンソール出力
- `config.json`でデバッグモードを有効化した場合の詳細ログ

## 🌐 Web化への移行準備

現在のデスクトップ版は、将来的なWeb化を想定した設計となっています。

### 移行時の変更点

#### 管理者機能
```
現在: python admin.py (デスクトップ)
将来: Web管理パネル (ブラウザ)
```

#### データベース
```
現在: SQLite (ローカルファイル)
将来: PostgreSQL/MySQL (サーバー)
```

#### 認証・権限
```
現在: ファイルレベルの分離
将来: Web認証 + ロールベースアクセス制御
```

### 移行準備チェックリスト

#### データの準備
- [ ] 問題データのCSVファイルを整理
- [ ] カテゴリ・難易度の統一
- [ ] データ品質の確認

#### 運用の準備
- [ ] バックアップ・復元手順の確立
- [ ] 管理者権限の整理
- [ ] 操作マニュアルの作成

### 移行時のデータ引き継ぎ

1. **問題データ**: CSVファイルまたはSQLiteから移行可能
2. **履歴データ**: SQLiteから新しいデータベースに移行
3. **設定情報**: Web版で再設定が必要

## 📞 サポート・お問い合わせ

### 管理者向けサポート情報

問題が発生した場合は、以下の情報を確認してください：

#### 収集すべき情報
1. **エラーメッセージ**: コンソールに表示された正確なメッセージ
2. **実行環境**: OS、Pythonバージョン
3. **データファイル**: 問題が発生したCSVファイル（可能であれば）
4. **データベース状況**: `python admin.py --info`の結果

#### ログの取得方法
```bash
# デバッグモードでの実行
python admin.py --import problem_file.csv > debug_log.txt 2>&1
```

#### 緊急時の対処
1. **データベース破損**: バックアップからの復元
2. **アプリ起動不可**: 統合版（`main.py`）での一時対応
3. **大量データ消失**: CSVファイルからの再インポート

---

**最終更新**: 2025年7月28日  
**対象バージョン**: 2.0  
**管理者ガイド版数**: 1.0